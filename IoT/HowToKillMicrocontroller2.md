
![enter image description here](https://habrastorage.org/files/1cc/989/7a6/1cc9897a66b04ab9af132751bd398718.jpeg)

В [первой](https://habrahabr.ru/post/308596/) части статьи я рассказал о том, как мне удалось превратить в "кирпич" микроконтроллер, задав неудачную комбинацию настроек. Проблема была в том, что у меня случайно получилось ввести в режим работы "по требованию" генератор, тактирующий ядро контроллера. При этом, отключалось все, в том числе и модуль отладки. Множество людей откликнулись на мою просьбу и дали мне несколько дельных советов и многие до сих пор спрашивают чем же все закончилось. Так вот история развивалась довольно комично но закончилась весьма банально. Подробности под катом.


----------

Итак, последовав советам опытных людей мы отправились перечитывать в User Manual разделы посвященные отладке и режимам загрузки контроллера. Оказалось что вроде как есть режим загрузки, при котором контроллер не начинает выполнять код а ждет подключение отладчика.

![enter image description here](https://habrastorage.org/files/b04/95c/b06/b0495cb0669945ebaa3173839aab3919.png)

Оставалось самое трудное - припаяться к нужным пинам чтобы правильно выполнить последовательность загрузки. Аппаратура, это сделать и не убить плату у нас находится в другом офисе, по этому плату нужно было везти туда и отдавать специалистам...

Но в день, когда мы собирались ее везти произошло нечто необъяснимое. Вечером плата была положена в пакетик, затем в коробку ну а коробка была убрана в сумку. Однако с утра платы в сумке не нашлось. Она просто исчезла! Мы перерыли всю сумку, все коробки которые нашли, обращались в бюро находок в автобусах, в которых ехала сумка... Все тщетно: потратив на поиски пару дней, решили плюнуть на эту плату и ждать пока будут изготовлены новые (а это почти 4 недели). Хорошо что при этом удалось продолжить работу с прошивкой, так как у нас была [Arduino M0](http://wiki.amperka.ru/%D0%BF%D1%80%D0%BE%D0%B4%D1%83%D0%BA%D1%82%D1%8B:arduinom0) с похожим процессором.

![enter image description here](https://habrastorage.org/files/3a6/8a4/40a/3a68a440ae2d4fc5820f6bf2b17709f0.jpg)

В тот момент мне вспомнился анекдот про русского и два титановых шарика, но было как-то не смешно.

Однако, в результате очередного мозгового штурма, мы вспомнили что перед тем как уехать домой с платой, была произведена уборка на столах. Мы бегом побежали к шкафам с деталями и, перерыв там все с низу до верху, нашли пропажу в том самом пакетике. Оказалось, что кто-то случайно в последний момент вынул плату из коробки и убрал ее к другим деталям. Потом коробку закрыли, положили в сумку и т.д. Вот теперь анекдот уже воспринимался не так печально.

В итоге, потратив еще день на пайку нужных проводов, мы приступили к оживлению. Тут стоит сказать, что пока мы развлекались поисками платы, к нам приехал J-Link. Правда не оригинал а дешевый аналог неизвестного производителя.

Так вот, как выяснилось, не нужно было ничего даже паять. Этот J-Link сходу увидел микроконтроллер, хотя дорогой и более "навороченный" ULink отказывался все время это делать.

После того, как злополучная прошивка была стерта, все встало на свои места и все отладчики без проблем смогли подключиться к контроллеру.

Мы предполагаем, что нас спасло то, что J-Link умеет тактировать модуль отладки сам в обход ядра. Я не знаю спецификации SWD и не разбирался глубоко в разнице между J-Link и ULink, но похоже что дешевый аналог работает лучше дорогого и навороченного. Правда, при этом, регулярно перегорает...

На этом история заканчивается. Плата работает, прошивка пишется. Всем спасибо за помощь!
